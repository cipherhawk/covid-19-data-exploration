--CREATE DATABASE covid_analysis;

USE covid_analysis;
DROP TABLE IF EXISTS covid_deaths;
CREATE TABLE covid_deaths (
    iso_code text,
    continent text,
    location text,
    date DATE,
    population BIGINT,
    total_cases INT,
    new_cases INT,
    new_cases_smoothed DOUBLE(10, 3),
    total_deaths INT,
    new_deaths INT,
    new_deaths_smoothed DOUBLE(10, 3),
    total_cases_per_million DOUBLE(10, 3),
    new_cases_per_million DOUBLE(10, 3),
    new_cases_smoothed_per_million DOUBLE(10, 3),
    total_deaths_per_million DOUBLE(10, 3),
    new_deaths_per_million DOUBLE(10, 3),
    new_deaths_smoothed_per_million DOUBLE(10, 3),
    reproduction_rate DOUBLE(10, 3),
    icu_patients INT,
    icu_patients_per_million DOUBLE(10, 3),
    hosp_patients INT,
    hosp_patients_per_million DOUBLE(10, 3),
    weekly_icu_admissions INT,
    weekly_icu_admissions_per_million DOUBLE(10, 3),
    weekly_hosp_admissions INT
);

USE covid_analysis;
LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/covid_deaths.csv'
INTO TABLE covid_deaths
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 ROWS
(
    iso_code, 
    continent, 
    location, 
    @date, 
    population, 
    @total_cases, 
    @new_cases, 
    @new_cases_smoothed, 
    @total_deaths, 
    @new_deaths, 
    @new_deaths_smoothed, 
    @total_cases_per_million, 
    @new_cases_per_million, 
    @new_cases_smoothed_per_million, 
    @total_deaths_per_million, 
    @new_deaths_per_million, 
    @new_deaths_smoothed_per_million, 
    @reproduction_rate, 
    @icu_patients, 
    @icu_patients_per_million, 
    @hosp_patients, 
    @hosp_patients_per_million, 
    @weekly_icu_admissions, 
    @weekly_icu_admissions_per_million, 
    @weekly_hosp_admissions
)
SET
    date = STR_TO_DATE(@date, '%m/%d/%Y'),
    total_cases = NULLIF(@total_cases, ''),
    new_cases = NULLIF(@new_cases, ''),
    new_cases_smoothed = NULLIF(@new_cases_smoothed, ''),
    total_deaths = NULLIF(@total_deaths, ''),
    new_deaths = NULLIF(@new_deaths, ''),
    new_deaths_smoothed = NULLIF(@new_deaths_smoothed, ''),
    total_cases_per_million = NULLIF(@total_cases_per_million, ''),
    new_cases_per_million = NULLIF(@new_cases_per_million, ''),
    new_cases_smoothed_per_million = NULLIF(@new_cases_smoothed_per_million, ''),
    total_deaths_per_million = NULLIF(@total_deaths_per_million, ''),
    new_deaths_per_million = NULLIF(@new_deaths_per_million, ''),
    new_deaths_smoothed_per_million = NULLIF(@new_deaths_smoothed_per_million, ''),
    reproduction_rate = NULLIF(@reproduction_rate, ''),
    icu_patients = NULLIF(@icu_patients, ''),
    icu_patients_per_million = NULLIF(@icu_patients_per_million, ''),
    hosp_patients = NULLIF(@hosp_patients, ''),
    hosp_patients_per_million = NULLIF(@hosp_patients_per_million, ''),
    weekly_icu_admissions = NULLIF(@weekly_icu_admissions, ''),
    weekly_icu_admissions_per_million = NULLIF(@weekly_icu_admissions_per_million, ''),
    weekly_hosp_admissions = NULLIF(@weekly_hosp_admissions, '')
;

USE covid_analysis;
DROP TABLE IF EXISTS covid_vaccinations;
CREATE TABLE covid_vaccinations (
    iso_code TEXT,
    continent TEXT,
    location TEXT,
    date DATE,
    total_tests BIGINT,
    new_tests INT,
    total_tests_per_thousand DOUBLE(10, 3),
    new_tests_per_thousand DOUBLE(10, 3),
    new_tests_smoothed BIGINT,
    new_tests_smoothed_per_thousand DOUBLE(10, 3),
    positive_rate DOUBLE(10, 3),
    tests_per_case DOUBLE(10, 3),
    tests_units TEXT,
    total_vaccinations BIGINT,
    people_vaccinated BIGINT,
    people_fully_vaccinated BIGINT,
    total_boosters BIGINT,
    new_vaccinations INT,
    new_vaccinations_smoothed BIGINT,
    total_vaccinations_per_hundred DOUBLE(10, 3),
    people_vaccinated_per_hundred DOUBLE(10, 3),
    people_fully_vaccinated_per_hundred DOUBLE(10, 3),
    total_boosters_per_hundred DOUBLE(10, 3),
    new_vaccinations_smoothed_per_million DOUBLE(10, 3),
    new_people_vaccinated_smoothed BIGINT,
    new_people_vaccinated_smoothed_per_hundred DOUBLE(10, 3),
    stringency_index DOUBLE(10, 3),
    population_density DOUBLE(10, 3),
    median_age DOUBLE(10, 3),
    aged_65_older DOUBLE(10, 3),
    aged_70_older DOUBLE(10, 3),
    gdp_per_capita DOUBLE(10, 3),
    extreme_poverty DOUBLE(10, 3),
    cardiovasc_death_rate DOUBLE(10, 3),
    diabetes_prevalence DOUBLE(10, 3),
    female_smokers DOUBLE(10, 3),
    male_smokers DOUBLE(10, 3),
    handwashing_facilities DOUBLE(10, 3),
    hospital_beds_per_thousand DOUBLE(10, 3),
    life_expectancy DOUBLE(10, 3),
    human_development_index DOUBLE(10, 3),
    excess_mortality_cumulative_absolute DOUBLE(10, 3),
    excess_mortality_cumulative DOUBLE(10, 3),
    excess_mortality DOUBLE(10, 3),
    excess_mortality_cumulative_per_million DOUBLE(10, 3)
);

USE covid_analysis;
LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/covid_vaccinations.csv'
INTO TABLE covid_vaccinations
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 ROWS
(
    iso_code,
    continent,
    location,
    @date,
    @total_tests,
    @new_tests,
    @total_tests_per_thousand,
    @new_tests_per_thousand,
    @new_tests_smoothed,
    @new_tests_smoothed_per_thousand,
    @positive_rate,
    @tests_per_case,
    tests_units,
    @total_vaccinations,
    @people_vaccinated,
    @people_fully_vaccinated,
    @total_boosters,
    @new_vaccinations,
    @new_vaccinations_smoothed,
    @total_vaccinations_per_hundred,
    @people_vaccinated_per_hundred,
    @people_fully_vaccinated_per_hundred,
    @total_boosters_per_hundred,
    @new_vaccinations_smoothed_per_million,
    @new_people_vaccinated_smoothed,
    @new_people_vaccinated_smoothed_per_hundred,
    @stringency_index,
    @population_density,
    @median_age,
    @aged_65_older,
    @aged_70_older,
    @gdp_per_capita,
    @extreme_poverty,
    @cardiovasc_death_rate,
    @diabetes_prevalence,
    @female_smokers,
    @male_smokers,
    @handwashing_facilities,
    @hospital_beds_per_thousand,
    @life_expectancy,
    @human_development_index,
    @excess_mortality_cumulative_absolute,
    @excess_mortality_cumulative,
    @excess_mortality,
    @excess_mortality_cumulative_per_million
)
SET
    date = STR_TO_DATE(@date, '%m/%d/%Y'),
    total_tests = NULLIF(@total_tests, ''),
    new_tests = NULLIF(@new_tests, ''),
    total_tests_per_thousand = NULLIF(@total_tests_per_thousand, ''),
    new_tests_per_thousand = NULLIF(@new_tests_per_thousand, ''),
    new_tests_smoothed = NULLIF(@new_tests_smoothed, ''),
    new_tests_smoothed_per_thousand = NULLIF(@new_tests_smoothed_per_thousand, ''),
    positive_rate = NULLIF(@positive_rate, ''),
    tests_per_case = NULLIF(@tests_per_case, ''),
    total_vaccinations = NULLIF(@total_vaccinations, ''),
    people_vaccinated = NULLIF(@people_vaccinated, ''),
    people_fully_vaccinated = NULLIF(@people_fully_vaccinated, ''),
    total_boosters = NULLIF(@total_boosters, ''),
    new_vaccinations = NULLIF(@new_vaccinations, ''),
    new_vaccinations_smoothed = NULLIF(@new_vaccinations_smoothed, ''),
    total_vaccinations_per_hundred = NULLIF(@total_vaccinations_per_hundred, ''),
    people_vaccinated_per_hundred = NULLIF(@people_vaccinated_per_hundred, ''),
    people_fully_vaccinated_per_hundred = NULLIF(@people_fully_vaccinated_per_hundred, ''),
    total_boosters_per_hundred = NULLIF(@total_boosters_per_hundred, ''),
    new_vaccinations_smoothed_per_million = NULLIF(@new_vaccinations_smoothed_per_million, ''),
    new_people_vaccinated_smoothed = NULLIF(@new_people_vaccinated_smoothed, ''),
    new_people_vaccinated_smoothed_per_hundred = NULLIF(@new_people_vaccinated_smoothed_per_hundred, ''),
    stringency_index = NULLIF(@stringency_index, ''),
    population_density = NULLIF(@population_density, ''),
    median_age = NULLIF(@median_age, ''),
    aged_65_older = NULLIF(@aged_65_older, ''),
    aged_70_older = NULLIF(@aged_70_older, ''),
    gdp_per_capita = NULLIF(@gdp_per_capita, ''),
    extreme_poverty = NULLIF(@extreme_poverty, ''),
    cardiovasc_death_rate = NULLIF(@cardiovasc_death_rate, ''),
    diabetes_prevalence = NULLIF(@diabetes_prevalence, ''),
    female_smokers = NULLIF(@female_smokers, ''),
    male_smokers = NULLIF(@male_smokers, ''),
    handwashing_facilities = NULLIF(@handwashing_facilities, ''),
    hospital_beds_per_thousand = NULLIF(@hospital_beds_per_thousand, ''),
    life_expectancy = NULLIF(@life_expectancy, ''),
    human_development_index = NULLIF(@human_development_index, ''),
    excess_mortality_cumulative_absolute = NULLIF(@excess_mortality_cumulative_absolute, ''),
    excess_mortality_cumulative = NULLIF(@excess_mortality_cumulative, ''),
    excess_mortality = NULLIF(@excess_mortality, ''),
    excess_mortality_cumulative_per_million = NULLIF(@excess_mortality_cumulative_per_million, '')
;
